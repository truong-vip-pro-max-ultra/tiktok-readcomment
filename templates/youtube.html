<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tiêu đề trang -->
  <title>Đọc comment livestream Youtube - Công cụ tương tác trực tuyến</title>

  <!-- Mô tả trang -->
  <meta name="description" content="Công cụ miễn phí giúp bạn đọc comment từ Youtube Live, tự động phản hồi và gửi lời cảm ơn tới người xem.">

  <!-- Thẻ Open Graph cho mạng xã hội -->
  <meta property="og:title" content="Đọc comment livestream Youtube - Công cụ tương tác trực tuyến">
  <meta property="og:description" content="Công cụ miễn phí giúp bạn đọc comment từ Youtube Live, tự động phản hồi và gửi lời cảm ơn tới người xem.">
  <meta property="og:image" content="https://cdn4.iconfinder.com/data/icons/remains/100/facebook_live_icon-2-512.png">
  <meta property="og:url" content="https://livestreamvoice.com">
  <meta property="og:type" content="website">
  <meta property="og:locale" content="vi_VN">

  <!-- Thẻ Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Đọc comment livestream Youtube - Công cụ tương tác trực tuyến">
  <meta name="twitter:description" content="Công cụ miễn phí giúp bạn đọc comment từ Youtube Live, tự động phản hồi và gửi lời cảm ơn tới người xem.">
  <meta name="twitter:image" content="https://cdn4.iconfinder.com/data/icons/remains/100/facebook_live_icon-2-512.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="https://cdn4.iconfinder.com/data/icons/remains/100/facebook_live_icon-2-512.png">

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Thư viện Three.js và Vanta.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.net.min.js"></script>

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5742059082599160" crossorigin="anonymous"></script>

  <!-- Dữ liệu có cấu trúc (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "Đọc comment livestream Youtube",
    "url": "https://livestreamvoice.com",
    "applicationCategory": "Utility",
    "operatingSystem": "All",
    "description": "Công cụ miễn phí giúp bạn đọc comment từ Youtube Live, tự động phản hồi và gửi lời cảm ơn tới người xem.",
    "image": "https://cdn4.iconfinder.com/data/icons/remains/100/facebook_live_icon-2-512.png"
  }
  </script>
</head>
    <style>
      /* Gradient động */
      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      .btn-modern {
        background: linear-gradient(270deg, #4203e6, #d5015a, #ecb508, #238f00);
        background-size: 600% 600%;
        animation: gradientShift 5s ease infinite;
        box-shadow:
          0 0 8px #f43f5e,
          0 0 20px #ec4899;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .btn-modern:hover {
        transform: scale(1.05);
        box-shadow:
          0 0 10px #f43f5e,
          0 0 20px #ec4899,
          0 0 30px #fb7185;
      }

      .btn-modern i {
        transition: transform 0.3s ease;
      }

      .btn-modern:hover i {
        transform: translateX(6px) scale(1.2);
      }
      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }

      .animate-gradient {
        background-size: 200% 200%;
        animation: gradientShift 3s ease infinite;
      }
    </style>

    <body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">

        <div class="bg-gray-800 p-8 rounded-2xl shadow-xl w-full max-w-md text-center">
            <h1 class="text-3xl font-extrabold mb-8 bg-gradient-to-r from-pink-400 via-red-400 to-yellow-400
                   bg-clip-text text-transparent drop-shadow-lg animate-gradient">
              ĐỌC COMMENT LIVESTREAM YOUTUBE
            </h1>

            <label for="username" class="block text-left text-sm mb-2">Nhập Link Youtube:</label>
            <input type="text" id="username" class="w-full px-4 py-2 rounded-md border border-gray-600 bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="ví dụ: https://www.youtube.com/watch?v=CUyoRAP9te0&ab_channel=MixiGaming" />

            <button id="startButton" onclick="startClient()"
                    class="btn-modern mt-6 w-full text-white font-bold py-3 px-6 rounded-2xl flex items-center justify-center gap-3 select-none shadow-lg relative overflow-hidden">
              <i class="fas fa-rocket"></i>
              Start
            </button>

            <h2 class="text-xl font-semibold mt-8 text-pink-300">Danh sách comment</h2>
            <div id="comment" class="mt-2 bg-gray-700 p-4 rounded-md h-48 overflow-y-auto text-left whitespace-pre-line"></div>

            <audio id="player" controls autoplay hidden></audio>

            <button id="yt" onclick="window.location.href='/'"
                    class="mt-10 w-full bg-blue-500 hover:bg-green-600 transition-colors text-white font-semibold py-2 px-4 rounded-lg shadow-md">
                Phiên bản TikTok
            </button>
        </div>

        <script>
            let currentComment = "";
            let username = "";

            async function startClient() {
                const button = document.getElementById("startButton");
                button.innerText = "Đang Đọc...";
                button.disabled = true;
                button.classList.add("opacity-50", "cursor-not-allowed");

                username = document.getElementById("username").value.trim();
                if (!username) {
                    showError("Vui lòng nhập link");
                    button.innerText = "Start";
                    button.disabled = false;
                    button.classList.remove("opacity-50", "cursor-not-allowed");
                    return;
                }

                // Gửi request bắt đầu
                await fetch("/youtube/start", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username })
                });

                // Xử lý audio "dọn đường" cho mobile
                const audio = document.getElementById("player");
                try {
                    audio.src = ""; // Làm sạch
                    await audio.play();
                    audio.pause();
                    audio.currentTime = 0;
                    console.log("Audio unlocked bởi người dùng.");
                } catch (err) {
                    console.warn("Trình duyệt không cho phép phát audio tự động:", err);
                }

                // Gọi lần đầu
                fetchComment();
            }

            function waitForAudioLoad(audio) {
                return new Promise((resolve, reject) => {
                    audio.oncanplaythrough = resolve;
                    audio.onerror = reject;
                });
            }

            async function fetchComment() {
                try {
                    const res = await fetch("/youtube/comment", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ username })
                    });
                    const data = await res.json();

                    if (data.latest_comment && data.latest_comment !== currentComment) {
                        currentComment = data.latest_comment;

                        const commentBox = document.getElementById("comment");
                        commentBox.innerText += currentComment + '\n';
                        commentBox.scrollTop = commentBox.scrollHeight;

                        const audio = document.getElementById("player");
                        {#audio.src = `/youtube/audio/${username}?t=${Date.now()}`;#}
                        const response = await fetch("/youtube/audio", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ username })
                        });

                        if (response.ok) {
                            const audioBlob = await response.blob();
                            const audioUrl = URL.createObjectURL(audioBlob);
                            const audio = new Audio(audioUrl);

                            audio.load();
                            audio.playbackRate = 1.5;

                            await waitForAudioLoad(audio);
                            audio.onended = () => {
                                fetchComment();
                            };
                            await audio.play();
                        } else {
                            console.error("Failed to fetch audio");
                            setTimeout(fetchComment, 1000);
                        }
                    } else {
                        setTimeout(fetchComment, 1000);
                    }
                } catch (err) {
                    console.error("Lỗi khi fetch hoặc phát audio:", err);
                    setTimeout(fetchComment, 1000);
                }
            }

        </script>

        <div id="vanta-bg" style="width: 100%; height: 100%; position: fixed; top: 0; left: 0; z-index: -1;"></div>
        <script>
          VANTA.NET({
            el: "#vanta-bg",
            mouseControls: true,
            touchControls: true,
            gyroControls: false,
            minHeight: 200.00,
            minWidth: 200.00,
            scale: 1.00,
            scaleMobile: 1.00,
            color: 0xff3f81,
            backgroundColor: 0x0d0d0d,
            points: 12.00,
            maxDistance: 20.00,
            spacing: 15.00
          });
        </script>


    <div id="errorPopup" class="fixed top-4 right-4 z-50 hidden bg-red-600 text-white px-6 py-4 rounded-lg shadow-lg animate-slide-in flex items-center gap-3">
      <i class="fas fa-exclamation-circle text-white text-xl"></i>
      <span id="errorMessage" class="flex-1">Lỗi xảy ra</span>
      <button onclick="hideError()" class="ml-4 text-white hover:text-yellow-200 focus:outline-none">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <style>
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(100%);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      .animate-slide-in {
        animation: slideIn 0.4s ease-out;
      }
    </style>

    <script>
      function showError(message) {
        const popup = document.getElementById("errorPopup");
        const msg = document.getElementById("errorMessage");

        msg.innerText = message;
        popup.classList.remove("hidden");

        // Tự ẩn sau 4 giây
        clearTimeout(window.errorTimeout);
        window.errorTimeout = setTimeout(() => {
          hideError();
        }, 4000);
      }

      function hideError() {
        const popup = document.getElementById("errorPopup");
        popup.classList.add("hidden");
      }

    </script>

    </body>
    </html>
